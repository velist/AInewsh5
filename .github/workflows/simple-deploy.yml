name: Simple Deploy to GitHub Pages

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Generate static site
      env:
        # 新闻API密钥
        VITE_GNEWS_API_KEY: ${{ secrets.VITE_GNEWS_API_KEY }}
        VITE_NEWSDATA_API_KEY: ${{ secrets.VITE_NEWSDATA_API_KEY }}
        VITE_NEWS_API_KEY: ${{ secrets.VITE_NEWS_API_KEY }}
        GNEWS_API_KEY: ${{ secrets.VITE_GNEWS_API_KEY }}
        NEWSDATA_API_KEY: ${{ secrets.VITE_NEWSDATA_API_KEY }}
        NEWS_API_KEY: ${{ secrets.VITE_NEWS_API_KEY }}
        # 翻译API密钥
        VITE_SILICONFLOW_API_KEY: ${{ secrets.VITE_SILICONFLOW_API_KEY }}
        VITE_BAIDU_APP_ID: ${{ secrets.VITE_BAIDU_APP_ID }}
        VITE_BAIDU_SECRET_KEY: ${{ secrets.VITE_BAIDU_SECRET_KEY }}
        VITE_TENCENT_SECRET_ID: ${{ secrets.VITE_TENCENT_SECRET_ID }}
        VITE_TENCENT_SECRET_KEY: ${{ secrets.VITE_TENCENT_SECRET_KEY }}
        VITE_ALIBABA_ACCESS_KEY_ID: ${{ secrets.VITE_ALIBABA_ACCESS_KEY_ID }}
        VITE_ALIBABA_ACCESS_KEY_SECRET: ${{ secrets.VITE_ALIBABA_ACCESS_KEY_SECRET }}
      run: npm run generate
      
    - name: Setup Pages
      uses: actions/configure-pages@v4
      
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: ./dist-static
        
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4